<!--
  ~ Copyright (c) 2020. Team Yojongdo, All rights reserved
  -->

<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>question</title>
    <link rel="stylesheet" href="../css/background.css">
    <link rel="stylesheet" href="../css/question.css"/>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="../js/question.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<div>
    <img alt="배경 사진" class="background" src="http://static-yojongdo.coronambti.com/images/background.svg">
</div>
<br/>
<h1>코로나 관련 성격 유형 검사</h1>
<div class="box" id="margin_Box">총 검사시간은<br>20분 이내입니다.</div>
<div class="box">분위기에 휩쓸리지 않고<br>정직하게 답변하세요.</div>
<div class="box">중립적인 선택은<br>되도록 피해주세요.</div>

<progress value="0" max="100" id="pg"></progress>

<svg height="10" width="300">
    <line x1="0" y1="1" x2="30" y2="1" stroke="black"/>
</svg>

<div class="question">
    <question-item
            v-for="question in questions"
            v-bind:question="question"
            v-bind:key="question.id"
    ></question-item>
    <div id = "nextButton" onclick="onNextClicked()" onclick="pgFunc()"><span>다음</span></div>
</div>
</body>

<script>
    var startPageIdx = 0;
    var answerStatus = {
        e: 0,
        s: 0,
        t: 0,
        j: 0
    } // 동의 +3 ~ -3 비동의

    function onNextClicked() {
        app.questions.forEach(function (question) {
            switch (question.type) {
                case 0:
                    answerStatus.e += Number.parseInt(question.status, 0);
                    break;
                case 1:
                    answerStatus.s += Number.parseInt(question.status, 0);
                    break;
                case 2:
                    answerStatus.t += Number.parseInt(question.status, 0);
                    break;
                case 3:
                    answerStatus.j += Number.parseInt(question.status, 0);
                    break;
            }
        });
        startPageIdx++;
        getJson(startPageIdx);
        if(startPageIdx == 3){
            document.getElementById('nextButton').innerHTML = "<span>완료</span>";
            document.getElementById('nextButton').onclick = onCompleteClicked;
        }
        for(let el of document.getElementsByClassName('radio')){
            el.classList.remove('selected');
        }

        for(let el of document.getElementsByClassName('neutral')){
            el.classList.add('selected');
        }
    }
    function onCompleteClicked() {
        location.href = './mbti_result.html?e='+answerStatus.e+'&s='+answerStatus.s+"&t="+answerStatus.t+"&j="+answerStatus.j;
        console.log("E : "+answerStatus.e +" S : "+answerStatus.s +" T :" +answerStatus.t+" J :"+answerStatus.j);
    }

    function optionClicked(event, item, option) {
        item.status = option;
        for(let el of event.target.parentElement.getElementsByClassName('radio')){
            el.classList.remove('selected');
        }
        event.target.classList.add('selected');
    }
    function getJson(startPage) {
        fetch('http://static-yojongdo.coronambti.com/json/' + 'mbti_page' + startPage + '.json')
            .then(response =>{
                return response.json();
            })
        .then(data => {
            app.questions = data;
        });
    }
    Vue.component('question-item', {
        props: ['question'],
        template: '<div class = "question_container"><div class="statement">' +
            '            <!--질문멘트-->{{ question.statement }}' +
            '        </div>' +
            '        <div class="decision">' +
            '            <span class="captionAgree">동의</span>' +
            '            <div class="options">' +
            '                <div class="agreeMax radio agree" v-on:click="optionClicked($event, question,3)"><span class="check" ></span></div>' +
            '                <div class="agreeMed radio agree" v-on:click="optionClicked($event, question,2)"><span class="check"></span></div>' +
            '                <div class="agreeMin radio agree" v-on:click="optionClicked($event, question,1)"><span class="check"></span></div>' +
            '                <div class="neutral radio selected" v-on:click="optionClicked($event, question,0)"><span class="check"></span></div>' +
            '                <div class="disagreeMin radio disagree" v-on:click="optionClicked($event, question,-1)"><span class="check"></span></div>' +
            '                <div class="disagreeMed radio disagree" v-on:click="optionClicked($event, question,-2)"><span class="check"></span></div>' +
            '                <div class="disagreeMax radio disagree" v-on:click="optionClicked($event, question,-3)"><span class="check"></span></div>' +
            '            </div>' +
            '            <span class="captionDisagree">비동의</span>' +
            '        </div>' +
            '        <hr/></div>'
    });
    var app = new Vue({
        el: '.question',
        data: {
            questions: []
        }
    })

    getJson(startPageIdx);


</script>

</html>
