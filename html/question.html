<!--
  ~ Copyright (c) 2020. Team Yojongdo, All rights reserved
  -->

<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>question</title>
    <link rel="stylesheet" href="../css/background.css">
    <link rel="stylesheet" href="../css/question.css"/>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<div>
    <img alt="배경 사진" class="background" src="http://static-yojongdo.coronambti.com/images/background.svg">
</div>
<br/>
<h1>코로나 관련 성격 유형 검사</h1>
<div class="box" id="margin_Box">총 검사시간은<br>20분 이내입니다.</div>
<div class="box">분위기에 휩쓸리지 않고<br>정직하게 답변하세요.</div>
<div class="box">중립적인 선택은<br>되도록 피해주세요.</div>

<div class="parent">
    <span class="progress">0%</span>
    <div class="progressBarBackground"></div>
    <span class="progress">100%</span>
</div>

<svg height="10" width="300">
    <line x1="0" y1="1" x2="30" y2="1" stroke="black"/>
</svg>

<div class="question">
    <question-item
            v-for="question in questions"
            v-bind:question="question"
            v-bind:key="question.id"
    ></question-item>
    <div class="nextButton" onclick="onNextClicked()"><span>다음</span></div>
</div>
</body>

<script>
    var startPageIdx = 0;
    var answerStatus = {
        e: 0,
        s: 0,
        t: 0,
        j: 0
    } // 동의 +3 ~ -3 비동의

    function onNextClicked() {
        app.questions.forEach(function (question) {
            switch (question.type) {
                case 0:
                    answerStatus.e += question.status;
                    break;
                case 1:
                    answerStatus.s += question.status;
                    break;
                case 2:
                    answerStatus.t += question.status;
                    break;
                case 3:
                    answerStatus.j += question.status;
                    break;
            }
        });
        startPageIdx++;
        getJson(startPageIdx);
        if(startPageIdx == 3){
            $('.nextButton span').innerText = "완료";
            $('.nextButton').onclick = "onCompleteClicked()";
        }
    }
    function onCompleteClicked() {
        console.log("E : "+answerStatus.E +" S : "+answerStatus.s +" T :" +answerStatus.t+" J :"+answerStatus.j);
    }

    function optionClicked(item, option) {
        item.status = option;
        console.log("Clicked! Op")
    }
    function getJson(startPage){
        $.ajax({
            url: 'http://static-yojongdo.coronambti.com/json/'+'mbti_page'+startPage+'.json',
            type: 'GET',
            dataType: "json",
            success: displayAll
        });

        function displayAll(data){
            Vue.component('question-item', {
                props: ['question'],
                template: '<div class = "question_container"><div class="statement">' +
                    '            <!--질문멘트-->{{ question.statement }}' +
                    '        </div>' +
                    '        <div class="decision">' +
                    '            <span class="captionAgree">동의</span>' +
                    '            <div class="options">' +
                    '                <div class="agreeMax radio agree" v-on:click="optionClicked(question,3)"><span class="check" ></span></div>' +
                    '                <div class="agreeMed radio agree" v-on:click="optionClicked(question,2)"><span class="check"></span></div>' +
                    '                <div class="agreeMin radio agree" v-on:click="optionClicked(question,1)"><span class="check"></span></div>' +
                    '                <div class="neutral radio" v-on:click="optionClicked(question,0)"><span class="check"></span></div>' +
                    '                <div class="disagreeMin radio disagree" v-on:click="optionClicked(question,-1)"><span class="check"></span></div>' +
                    '                <div class="disagreeMed radio disagree" v-on:click="optionClicked(question,-2)"><span class="check"></span></div>' +
                    '                <div class="disagreeMax radio disagree" v-on:click="optionClicked(question,-3)"><span class="check"></span></div>' +
                    '            </div>' +
                    '            <span class="captionDisagree">비동의</span>' +
                    '        </div>' +
                    '        <hr/></div>'
            });
            $('.options .radio').onclick = function(){
                console.log("Clicked!")
                $(this).parent().find('.radio').removeClass('selected');
                $(this).addClass('selected');
            };
            app.questions = data;
        }
    }

    getJson(startPageIdx);
    var app = new Vue({
        el: '.question',
        data: {
            questions: []
        }
    })


</script>

</html>
